## 本章内容

> 1、理解基本类型和引用类型的值
>
> 2、理解执行环境
>
> 3、理解垃圾收集

JavaScript 的变量是松散类型，意味着变量的值及其数据类型可以在脚本的生命周期内改变。

### 4.1  基本类型和引用类型的值
**基本数据类型：**null、undefined、Number、Boolean、String。

```
基本数据类型是按值访问的，因此可以操作保存在变量中的实际的值
```

**引用类型的值** 是保存在内存中的对象。

```
JavaScript 不允许直接访问内存中的位置，即不能直接操作对象的内存空间。
在操作对象时，实际上是操作对象的引用而不是实际的对象。
```

#### 4.1.1 动态的属性

只能给引用类型变量动态添加属性，不能给基本数据类型动态添加属性

```javascript
var a = 1;
a.name = 'x';
console.log(a.name); // undefined
var b = {x: 1};
b.name = 'x';
console.log(b.name); // 'x'
```

#### 4.1.2 复制变量值

基本数据类型的变量在内存中占据不同的位置，所以复制时不会相互影响

```javascript
var a = 1;
b = a;
b = 2;
console.log(a); // 1
```

引用类型的变量在内存中只有一份，实际调用的是指向这块内存空间的指针，所以复制时会相互影响

```javascript
var a = {};
var b = a;
b.x = 1;
console.log(a.x); // 1
```

关于引用类型变量复制的问题会引申出：原型链和继承。

#### 4.1.3 参数传递

ECMAScript中所有函数的参数都是**按值传递**的。即，函数外部的值复制给函数内部的参数按以下规则：

> 1、基本数据类型值的传递按基本数据类型变量复制，即外部的值跟内部的值不会相互影响
>
> 2、引用类型数据值的传递按引用类型变量复制，即内外都会相互影响

#### 4.1.4 检测类型

检测基本数据类型可以用 `typeof`

检测引用类型可以用 `instanceof`

更强的应该使用 `Object.prototype.toString.call(value)`

>其中vlaue就是要检测的值，返回结果是 "[object type]"，可以通过检测 type 判断value 的类型



### 4.2 执行环境及作用域

执行环境（execution context，有的会翻译成执行上下文。简称“环境”）是JavaScript中最为重要的一个概念。执行环境定义了变量或函数有权访问的其他数据，决定了它们各自的行为。每个执行环境都有一个与之关联的**变量对象**，环境中定义的所有变量和函数都保存在这个对象中。

> 我们编写的代码无法访问这个对象，但解析器在处理数据时会在后台使用它。

全局执行环境是最外围的一个执行环境，在web浏览器中，这个最外围的执行环境是 `window`对象。某个执行环境中的所有代码执行完毕后，该环境被销毁，其中的变量和函数也随之销毁。

> 全局执行环境直到应用程序退出，例如关闭网页或退出浏览器，才会被销毁

在ES6开始，全局对象和全局变量是两个概念了。

> 为了保持兼容性，`var` 关键字声明的全局变量依然在全局对象window上，`let`、`const`、`class`声明的全局变量挂在**全局变量对象**上。
>
> 无法直接访问全局变量对象，但是可以直接访问它上面的全局变量。
>
> 在chrome控制台可以通过 scope作用域查看全局变量对象

函数的执行环境，即作用域链的概念。作用域链上可以访问两个对象

> 1、全局对象，即函数能访问到的所有全局对象，包括window、document等
>
> 2、活动对象，函数执行时才会被加入到作用域链，能够访问函数内部的变量
>
> > 活动对象最开始只包含当前函数的变量，然后依次到包含该函数的环境可以访问的变量，直到最后一个变量

作用域链可以从下往上访问，但不能从上往下访问，这也是作用域存在的意义。

> 从下往上的意思，作用域链的最底层即当前执行环境，类似于冒泡

 #### 4.2.1 延长作用域链

JavaScript的执行环境只有两种：全局和局部（函数），但可以通过以下方法延长作用域链。

> 1、try-catch语句的catch块
>
> 2、with语句（这个不推荐用了）

会在作用域链的前端添加一个对象，catch语句会创建一个新的变量对象，其中包含的是被抛出的错误对象的声明。该变量对象会在代码执行后被移除。

#### 4.2.2  没有块级作用域

在其他语言如 `C`，花括号封闭的代码都有自己的作用域，但是JavaScript中没有，如下代码：

```javascript
if (true){var color="red"};console.log(color); // 'red'
```

使用 var 声明的变量会自动被添加到最接近的环境中。

但是这个问题再ES6被其他关键字解决了，如下：

```javascript
if (true){let color2="red"};console.log(color2); // 'color2 is not defined'
```

也就是说，**从ES6开始，JavaScript引入了块级作用域的概念！**

> 在JavaScript中，访问局部变量要比全局变量快，因为不用向上搜索。

### 4.3 垃圾收集

JavaScript具有